<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taller Empleo</title>
    <style>
            /* CSS */
.carta {
  perspective: 1000px; /* Profundidad 3D */
}

.cartaInterna {
  width: 300px;
  height: 200px;
  position: relative;
  transform-style: preserve-3d;
  transition: transform 0.6s;
  margin: auto;
}

/* .carta:hover .cartaInterna {
  transform: rotateY(180deg);
} */

.anverso {
  position: absolute;
  width: 100%;
  height: 100%;
  backface-visibility: hidden; /* Oculta la cara trasera cuando está girada */
}

.reverso {
  transform: rotateY(180deg);
}

/* Aquí viene lo importante: forzar al <img> a llenar la cara sin salirse */
.anverso img {
  display: block;          /* elimina espacios en blanco alrededor */
  width: 100%;             
  height: 100%;            
  object-fit: cover;       /* recorta para mantener proporción */
}

form {
    width: 50%;
    height: 25rem;
    background-color: wheat;
    margin: auto;
    text-align: center;
}
.borde {
    border: solid black 0.125rem;
}

#btn {
    background-color: green;
    color: white;
}

#reini {
    background-color: red;
    color: white;
}

#pista {
    text-align: left;
}

label {
    font-weight: bolder;
}

h1 {
    padding-top: 1.5rem;
}

</style>
</head>

<body>
    

    <form autocomplete="off" method="get" id="formAdivina">
        <h1> ADIVINA EL VEGETAL </h1>
        <div>
            <label for="a">Escribe el nombre de un vegetal:</label>
            <input type="text" name="a" id="a" value="">
            <button type="submit" id="btn">Comprobar</button>
            <button type="button" id="reini">Reiniciar</button>
        </div>

        <div>
            <p id="respu">&nbsp;</p>
        </div>     
        
        <div class="carta" style="width: 50%; float: left;">
            <div class="cartaInterna">
                <div class="anverso" id="anver">
                    <img src="img/interrogante.png" alt="Anverso de la carta" >
                </div>
                <div class="anverso reverso" id="rever">
                    <img src="" alt="Reverso de la carta" class="borde">
                </div>
            </div>
        </div>
        <div style="width: 50%; float: left;">
        <ul id="pista"></ul>
        </div>
        <figure id="figura">
            <img src="" id="imagen">
        </figure>
        
    </form>

    <script>
        // let n = parseInt(Math.random() * 5)
        
        let contador = 0
        let intentos = 4
        let contenido, n, carta, inner, reverso
        function usar () {
                if (peticion.readyState == 4 && peticion.status == 200) {
                    // Recibo el archivo como texto y lo paso a JSON
                    contenido = JSON.parse(peticion.responseText);
                    
                    let b = (contenido.vegetal).length
                    n = parseInt(Math.random() * b)
                    console.log(n)
                    // respu.style.display = 'block';
                    
                    pista.style.display = 'block';
                    // Fuera de tu función comprueba(), al inicio del <script>:
                    carta = document.querySelector('.carta');          // el contenedor
                    inner = document.querySelector('.cartaInterna');   // la parte giratoria
                    reverso = document.getElementById('rever');          // la <div> o <img> del reverso
                }
            }
                 // Crear un objeto global para AJAX
                let peticion = new XMLHttpRequest      
                // Construyo el nombre comleto del archivo a traer del servidor
                let archivo = 'vegetales.json';
                peticion.open('get', archivo)
                // Al ser get y sin parametros la envia directa
                peticion.send(null)
                // Preparo la peticion de respuesta
                peticion.onreadystatechange = usar
        
       
            function comprueba() {
               pista.style.display = 'block';
               respu.style.visibility = 'visible'

                            if (contador > 3) {

                                    respu.style.color = 'red'
                                    respu.style.fontWeight = 'bolder'
                                    respu.innerHTML = '¡¡¡FALLASTE!!! Has agotado el número de intentos'
                                    // Gira la parte interna 180° para mostrar el reverso
                                    inner.style.transform = 'rotateY(180deg)';

                                    // Cambia la imagen del reverso
                                    reverso.querySelector('img').src = contenido.vegetal[n].imagen;
                            }

                            if (a.value.toLowerCase() == contenido.vegetal[n].nombre && contador <= 4) {
                                
                                respu.style.color = 'green'
                                respu.style.fontWeight = 'bolder'
                                respu.innerHTML = '¡¡¡ACERTASTE!!! Necesitaste un total de ' + contador + ' intentos'

                                contador = undefined
                                // Gira la parte interna 180° para mostrar el reverso
                                inner.style.transform = 'rotateY(180deg)';

                                // Cambia la imagen del reverso
                                reverso.querySelector('img').src = contenido.vegetal[n].imagen;

                                document.getElementById('btn').removeEventListener('click', comprueba)


                            }

                            

                            if (a.value != contenido.vegetal[n].nombre && contador <= 3) {
                                
                                respu.style.color = 'black'
                                respu.style.fontWeight = 'bolder'
                                respu.innerHTML = 'Error. Te quedan ' + intentos + ' intentos'
                                intentos--
                                // console.log(contenido.vegetal[n].pistas+'[contador]')
                                
                                pista.innerHTML += '<li>' + contenido.vegetal[n].pistas[contador] + '</li>'
                                contador++
                                console.log(contador)
                            }

                            
                        }    
                         
                    
                    document.getElementById('reini').addEventListener('click', function () {
                        
                        const reverso = document.getElementById('rever');
                        const anverso = document.getElementById('anver');
                        respu.style.visibility = 'hidden';
                        pista.style.display = 'none';
                        pista.innerHTML = '<li style="display: none;">' + '' + '</li>'
                        contador = 0
                        intentos = 4
                        reverso.querySelector('img').src = "img/interrogante.png"

                        // document.getElementById('btn').addEventListener('click', comprueba)
                        let b = (contenido.vegetal).length
                        n = parseInt(Math.random() * b)
                        console.log(n)
                    })

                
            
// Para que enter/intro hagan de comprobador
                const form = document.getElementById('formAdivina');
                form.addEventListener('submit', function (e) {
                    e.preventDefault();  // evita recarga de la página
                    comprueba();         // tu función de verificación
                });
            
            // Incorporamos un escuchador al evento click
            // document.getElementById('btn').addEventListener('click', comprueba)
            
        
    </script>
</body>

</html>